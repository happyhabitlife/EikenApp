<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
    </style>
</head>
<body>
    <h1>ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</h1>
    <div id="log"></div>
    <div id="question-display">
        <h2 id="question-text">å•é¡ŒãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</h2>
        <div id="choices-container"></div>
    </div>

    <script>
        const log = document.getElementById('log');
        
        function addLog(message, type = 'debug') {
            console.log(message);
            const div = document.createElement('div');
            div.className = `debug ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            log.appendChild(div);
        }

        // CSVãƒ‘ãƒ¼ã‚µãƒ¼é–¢æ•°
        const parseCSVLine = (line) => {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        };

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function runTest() {
            addLog('ğŸš€ ãƒ†ã‚¹ãƒˆé–‹å§‹', 'success');
            
            try {
                addLog('ğŸ“¥ CSVãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿é–‹å§‹...');
                const response = await fetch('eiken_words_problems.csv');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const csvData = await response.text();
                addLog(`âœ… CSVãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ (${csvData.length} characters)`, 'success');
                
                const lines = csvData.trim().split('\\n');
                addLog(`ğŸ“„ è¡Œæ•°: ${lines.length}`);
                
                // æœ€åˆã®å•é¡Œã‚’è¡¨ç¤ºã—ã¦ãƒ†ã‚¹ãƒˆ
                if (lines.length > 1) {
                    const firstLine = lines[1];
                    addLog(`ğŸ” æœ€åˆã®ãƒ‡ãƒ¼ã‚¿è¡Œ: ${firstLine.substring(0, 100)}...`);
                    
                    const values = parseCSVLine(firstLine);
                    addLog(`ğŸ”§ ãƒ‘ãƒ¼ã‚¹çµæœ (${values.length}å€‹):`, 'success');
                    values.forEach((val, i) => {
                        addLog(`  [${i}] ${val.substring(0, 50)}${val.length > 50 ? '...' : ''}`);
                    });
                    
                    if (values.length >= 8) {
                        const questionObj = {
                            id: parseInt(values[0]),
                            question: values[1].replace(/^"(.*)"$/, '$1'),
                            choices: [
                                values[2].replace(/^"(.*)"$/, '$1'),
                                values[3].replace(/^"(.*)"$/, '$1'),
                                values[4].replace(/^"(.*)"$/, '$1'),
                                values[5].replace(/^"(.*)"$/, '$1')
                            ],
                            correct_answer_index: parseInt(values[6]),
                            explanation: values[7].replace(/^"(.*)"$/, '$1')
                        };
                        
                        addLog('âœ¨ å•é¡Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæˆåŠŸ', 'success');
                        addLog(`å•é¡ŒID: ${questionObj.id}`);
                        addLog(`å•é¡Œæ–‡: ${questionObj.question}`);
                        addLog(`é¸æŠè‚¢: ${questionObj.choices.join(', ')}`);
                        
                        // å®Ÿéš›ã«DOMè¦ç´ ã«è¡¨ç¤º
                        document.getElementById('question-text').textContent = questionObj.question;
                        const container = document.getElementById('choices-container');
                        container.innerHTML = '';
                        
                        questionObj.choices.forEach((choice, index) => {
                            const button = document.createElement('button');
                            button.textContent = `${index + 1}. ${choice}`;
                            button.style.display = 'block';
                            button.style.margin = '5px';
                            button.style.padding = '10px';
                            container.appendChild(button);
                        });
                        
                        addLog('ğŸ¯ å•é¡Œè¡¨ç¤ºå®Œäº†ï¼', 'success');
                    } else {
                        addLog(`âŒ ãƒ‡ãƒ¼ã‚¿ãŒä¸å®Œå…¨ã§ã™ (${values.length}/8)`, 'error');
                    }
                } else {
                    addLog('âŒ CSVã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                }
                
            } catch (error) {
                addLog(`âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ: ${error.message}`, 'error');
                console.error(error);
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', runTest);
    </script>
</body>
</html>